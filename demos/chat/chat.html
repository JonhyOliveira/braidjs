<!doctype html>
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <meta charset="utf-8">
   <title>Braid Chat</title>
   <link rel="stylesheet" href="chat.css" type="text/css">
   <link rel="stylesheet" href="mobile.css" type="text/css">

   <!-- Load libraries-->
   <script type="module">
      import { openDB, deleteDB, wrap, unwrap } from 'https://unpkg.com/idb?module';
  
      window.idb = {
         openDB, deleteDB, wrap, unwrap
      };
    </script>
   <script src="braid-bundle.js" type="text/javascript"></script>
   <script src="https://unpkg.com/react@16/umd/react.development.js"></script> 
   <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
   <script src="chat.js" type="text/javascript"></script>
   <script>
      function resetText(){
         console.log("reset text");
         let gridContainer = document.getElementById("grid-container");
         gridContainer.style.gridTemplateRows = "100px auto 85px 1.5em"
      }
      function inputSize(){
         let textarea = document.getElementById("send-box");
         let headerSize = '40'
         var taLineHeight = 45
         if(screen.width < 800){
            headerSize = '100';
            taLineHeight = 45;
         }
         let textAreaHeight = 85;
         let gridContainer = document.getElementById("grid-container");
         gridContainer.style.gridTemplateRows = `${headerSize}px auto 90px 1.5em`
         var taHeight = textarea.scrollHeight; // Get the scroll height of the textarea
         console.log("scroll height" + taHeight)
         textarea.style.height = taHeight; // This line is optional, I included it so you can more easily count the lines in an expanded textarea
         var numberOfLines = Math.floor(taHeight/taLineHeight);
         console.log( "there are " + numberOfLines + " lines in the text area");
         if(numberOfLines == 1){
            gridContainer.style.gridTemplateRows = `${headerSize}px auto 85px 1.5em`
         }else if(numberOfLines == 2){
            gridContainer.style.gridTemplateRows = `${headerSize}px auto 125px 1.5em`
         }else if(numberOfLines == 3){
            gridContainer.style.gridTemplateRows = `${headerSize}px auto 175px 1.5em`
         }else if(numberOfLines >= 4){
            gridContainer.style.gridTemplateRows = `${headerSize}px auto 220px 1.5em`
         }
      }
   </script>
</head>

<body>
   <div class="grid-container" id = "grid-container">
      <header>
         <h2 class="title" style = "display:inline;">Braid Chat</h2>
         <div id="settings-hover-container">
            <span class="settings-expand" id="username-btn">Username:</span>
            <input id="username-change" class="settings-expand settings-input-collapse collapsed"></input>
            <a href="/settings"><img src ="https://image.flaticon.com/icons/png/512/126/126472.png" id = "settings-icon"></a>
         </div>
      </header>
      <div id="react-messages"></div>
      <div class="input">
         <textarea id="send-box" oninput="inputSize()"></textarea>
         <span id="send-msg" onclick="resetText()"><img src ='white-airplane.png'></span>
      </div>
      <div id="typing" class="hidden">
         <span class="typing-anim">
            <span></span>
            <span></span>
            <span></span>
         </span>
         <span id="typing-text"></span>
      </div>
   </div>
   <input id="expo-token" style="display:none"></input>
   
</body>
</html>
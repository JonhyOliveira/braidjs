<script>
function require (thing) {
    thing = thing.split('/')
    thing = thing[thing.length-1].slice(0,-3)
    console.assert(require[thing], `Thing ${thing} don't exist on ${Object.keys(require)}!`)
    return require[thing]
}
global = window
module = {exports: {}}
require.random001 = true
</script>
<script src="./utilities.js"></script>
<script src="./events.js"></script>
<script src="./merge-algorithms/sync9.js"></script>
<script src="./node.js"></script>
<script src="./pipe.js"></script>
<script src="./resource.js"></script>
<!--<script src="./networks/http-client.js"></script>-->
<script src="./networks/websocket-client.js"></script>
<body></body>

<script>; // So Mike's editor will indent properly
node = require('./node.js')()
node.pid = 'C'
require('./networks/websocket-client.js')({node})


global_origin = {}
function get (k, cb) {
    if (typeof k === 'object')
        node.get(k)
    else {
        console.assert(typeof k === 'string')
        var origin = cb
            ? {send(args) {
                if (args.method === 'set'
                    || args.method === 'welcome') {
                    //console.trace('got msg of', args)
                    cb && cb(node.resources[k].mergeable.read())}}}
            : global_origin
        node.get({key: k, origin})
    }
    return node.resources[k].mergeable.read()
}
function set (k, v, patches) {
    if (!patches)
        patches = ['= ' + JSON.stringify(v)]
    else
    if (typeof patches === 'string')
        patches = [patches]

    node.set({key: k, patches})
}

//print_network = true
// show_debug = true
</script>